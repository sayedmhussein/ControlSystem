@using WeeControl.Frontend.ApplicationService.Interfaces
@using WeeControl.Frontend.Wasm.Layouts.Components
@inherits LayoutComponentBase
@attribute [AllowAnonymous]

@inject IDeviceSecurity DeviceSecurity
@inject NavigationManager NavManager

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudPaper Class="d-flex flex-column flex-grow-1 gap-4" Elevation="0">
    <CustomerToolbarComponent ShowLogin="@showLoginButton" ShowLogout="@showLogoutButton">
    </CustomerToolbarComponent>
    <MudItem Class="d-flex flex-grow-0 align-self-center justify-center justify-content-center">
        <MudPaper Class="d-flex flex-column flex-grow-1 gap-4" Elevation="0">
            @Body
        </MudPaper>
    </MudItem>
</MudPaper>

@code
{
    private bool showLoginButton;
    private bool showLogoutButton;

    protected override async Task OnInitializedAsync()
    {
        if (await DeviceSecurity.IsAuthenticatedAsync())
        {
            showLoginButton = false;
            showLogoutButton = true;
        }
        else
        {
            showLoginButton = true;
            showLogoutButton = false;
        }

        var currentPageName = NavManager.Uri.Split("/").Last();
        if (currentPageName is Pages.Anonymous.LoginPage or Pages.Anonymous.SplashPage)
        {
            showLoginButton = false;
        }

        await base.OnInitializedAsync();
    }
}
