@using WeeControl.Frontend.ApplicationService.Interfaces
@using WeeControl.Frontend.ApplicationService.Contexts.Common
@using WeeControl.Frontend.ApplicationService.Contexts.Anonymous.Interfaces
@inject IUserHomeViewModel HomeViewModel
@inject IAuthorizationViewModel AuthorizationViewModel
@inject IDevicePageNavigation Navigation

<MudToolBar Elevation="25">
    <MudLink Href="/">
        <MudImage Src="images/logo.png" Alt="WeeControl" Width="20" Height="20" Style="margin-right: 5px"></MudImage>
    </MudLink>
    <MudText>WeeControl</MudText>
    @if (ShowLogout)
    {
        <MudMenu Label="Customer Operations" Dense="true" EndIcon="@Icons.Filled.KeyboardArrowDown" IconColor="Color.Primary">
            <MudMenuItem>Home Page</MudMenuItem>
            <MudMenuItem>My Units</MudMenuItem>
            <MudMenuItem>Request Service</MudMenuItem>
            <MudSpacer></MudSpacer>
            <MudMenuItem>Complain</MudMenuItem>
        </MudMenu>
        <MudMenu Label="Employee Operations" Dense="true" EndIcon="@Icons.Filled.KeyboardArrowDown" IconColor="Color.Primary">
            @foreach (var b in HomeViewModel.MenuItems)
            {
                <MudMenuItem>@b.PageName</MudMenuItem>
            }
        </MudMenu>
    }
    <MudSpacer></MudSpacer>
    @if (ShowLogin)
    {
        <MudIconButton 
            Icon="@Icons.Material.Outlined.Login" 
            Color="Color.Primary" Title="Login"
            OnClick="@(() => Navigation.NavigateToAsync(Pages.Anonymous.LoginPage))"
        ></MudIconButton>
        <MudIconButton 
            Icon="@Icons.Material.Outlined.AppRegistration" 
            Color="Color.Primary" Title="Register"
            OnClick="@(() => Navigation.NavigateToAsync(Pages.Anonymous.CustomerRegisterPage))"
        ></MudIconButton>
    }
    @if (ShowLogout)
    {
        <MudText>@HomeViewModel.GreetingMessage</MudText>
        <MudIconButton Icon="@Icons.Material.Outlined.Notifications" />
        <MudIconButton Icon="@Icons.Material.Outlined.Menu" />
        <MudIconButton
            Icon="@Icons.Material.Outlined.Logout"
            Color="Color.Inherit"
            Title="Logout"
            OnClick="@AuthorizationViewModel.Logout"
            />
    }
</MudToolBar>

@code {
    [Parameter]
    public bool ShowLogin { get; set; }
    
    [Parameter]
    public bool ShowLogout { get; set; }

    protected async override Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        await HomeViewModel.Refresh();
    }

    private async Task Logout()
    {
        await AuthorizationViewModel.Logout();
        ShowLogin = true;
        StateHasChanged();
    }
}